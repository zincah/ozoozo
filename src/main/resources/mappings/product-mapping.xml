<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 
<mapper namespace="ProductDAO">

	<!-- selectkey 찾아보기 -->
	
	<!-- insert product_posting -->
	<insert id="insertPostId" parameterType="product">
		insert into product_posting (post_id) values ((SELECT COALESCE(MAX(post_id), 50000)+1 from product_posting));
	</insert>
	
	<!-- select product_posting id -->
	<select id="selectPostIdOne" resultType="Integer">
		SELECT MAX(post_id) FROM product_posting
	</select>

	<!-- product insert -->
	<insert id="insertProduct" parameterType="product">
		INSERT INTO product(product_id, seller_id, product_title, pro_catecode, pro_subcatecode, product_price, product_quantity, product_postid) VALUES 
		((SELECT COALESCE(MAX(product_id), 1000)+1 FROM product), #{seller_id}, #{product_title}, #{pro_catecode}, #{pro_subcatecode}, #{product_price}, #{product_quantity}, #{product_postid})
	</insert>
	
	<!-- option insert -->
	<insert id="insertOption" parameterType="product">
		INSERT INTO product_option(op_productid, option1_name, option1, option2_name, option2) VALUES 
		((SELECT MAX(product_id) FROM product), #{option1_name}, #{option1}, #{option2_name}, #{option2})
	</insert>
	
	<!-- product detail insert -->
	<insert id="insertDetail" parameterType="product">
		INSERT INTO product_detail values 
		((SELECT COALESCE(MAX(detail_id), 0)+1 FROM product_detail), #{detail_content}, #{detail_table}, #{prodetail_postid})
	</insert>
	
	
	<!-- product posting insert -->
	<update id="updatePost" parameterType="product">
		UPDATE product_posting SET  
		post_name = #{post_name}, 
		sale_ratio = #{sale_ratio}, 
		whole_price = #{whole_price}, 
		shipping_info1 = #{shipping_info1}, 
		shipping_info2 = #{shipping_info2}, 
		post_sellerid = #{post_sellerid} 
		WHERE post_id = #{post_id}
	</update>
	
	<!-- photo upload -->
	<insert id="insertPhoto" parameterType="product">
		INSERT INTO product_image (photo_url, photo_separate, photo_postid)
		VALUES (#{photo_url}, #{photo_separate}, #{photo_postid})
	</insert>

	<!-- 상품+상품상태 테이블 -->
	<select id="selectProduct" resultType="product">
		SELECT * FROM product p JOIN product_status ps ON p.product_id = ps.st_product_id WHERE seller_id = #{seller_id};
	</select>
	
	<!-- jsp 테이블에 뿌릴 상품목록 -->
	<select id="selectProductView" resultType="product">
		SELECT p.product_id, 
		p.product_seller_code, 
		p.product_title, 
		p.product_price, 
		(SELECT cate_name FROM category c WHERE p.pro_catecode = c.cate_code) AS category_name, 
		ps.status, 
		p.product_quantity, 
		p.product_created, 
		p.product_updated FROM product p 
		JOIN product_status ps ON p.product_id = ps.st_product_id 
		WHERE seller_id = #{seller_id};
	</select>

	

</mapper>